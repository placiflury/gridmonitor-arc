<%inherit file="/base/monadmin.html"/>

<%def name="dom_ready()" >\
	var MA_site_list = Object.create(ListController);
	MA_site_list.container = $('#MA_site_list_container');
	MA_site_list.set_title('Sites:');
	MA_site_list.set_link('new', 'Add site');
	MA_site_list.set_link('del', 'Remove site');
	MA_site_list.init('MA_site_list', 'getsites');
	var MA_site_editor = Object.create(ListEditor);
	MA_site_editor.container = $('#MA_site_editor_container');
	MA_site_editor.status_container = $('#MA_status');
	MA_site_editor.url = 'changesite';
	MA_site_editor.click = true;
	MA_site_editor.flush_container = true;
	MA_site_editor.init(MA_site_list);
	
	var MA_service_list = Object.create(ListController);
	MA_service_list.container = $('#MA_service_list_container');
	MA_service_list.set_title('Services:');
	MA_service_list.set_link('new', 'Add service');
	MA_service_list.set_link('del', 'Remove service');
	MA_service_list.init('MA_service_list', 'getservices');
	MA_service_list.hide();
	var MA_service_editor = Object.create(ListEditor);
	MA_service_editor.container = $('#MA_site_editor_container');
	MA_service_editor.status_container = $('#MA_status').hide();
	MA_service_editor.url = 'changeservice';
	MA_service_editor.click = true;
	MA_service_editor.flush_container = true;
	## Special Case for adding services:
	MA_service_editor.new_child = function(fields, that) {
		var that = that || this;
		var site_name = MA_site_list.get_selected().data('info').name;
		this.http_get_params = '?source_id=MA_site_list&target_id=MA_service_list&name=' + site_name;
		var fields = {};
		fields['site_name'] = $('<div id="site_name"/>');
		fields['type'] = $('<select id="type" type="select" size="1"/>');
		that.__proto__.new_child(fields, that);
		fields['site_name'].val(undefined).text(site_name);
		fields['type'].text('')
		%for type in c.service_names:
			fields['type'].append('<option>${type.strip()}</option>');
		%endfor
	};
	MA_service_editor.init(MA_service_list);
	
	var MA_mapper = Object.create(ListMapper);
	MA_mapper.init(MA_site_list, MA_service_list);
	
	MA_site_list.links.click(function() {
		MA_service_list.hide();
	});
</%def>

<div id="MA_site_list_container"></div>
<div id="MA_service_list_container"></div>
<div id="MA_site_editor_container"></div>
<div id="MA_status"></div>